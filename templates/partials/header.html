
{% load static %} 

<div class="app-header__logo">
    <div class="logo-container" style="display: flex; align-items: center; gap: 10px;">
        {% if sacco_logo %}
            <!-- Sacco logo image -->
            <div class="logo-src" style="background-image: url('{{ sacco_logo.url }}'); width: 40px; height: 40px; background-size: contain; background-repeat: no-repeat; background-position: center;"></div>
        {% endif %}
        
        <!-- Sacco name in Pacifico font -->
        <div class="logo-text" style="font-family: 'Pacifico', cursive; font-size: 1.6rem; color: #fff; white-space: nowrap;">
            {{ sacco_short_name|default:"Kojena" }}
        </div>
    </div>
    <div class="header__pane ms-auto">
        <div>
            <button type="button" class="hamburger close-sidebar-btn hamburger--elastic" data-class="closed-sidebar">
                <span class="hamburger-box">
                    <span class="hamburger-inner"></span>
                </span>
            </button>
        </div>
    </div>
</div>

<div class="app-header__mobile-menu">
    <div>
        <button type="button" class="hamburger hamburger--elastic mobile-toggle-nav">
            <span class="hamburger-box">
                <span class="hamburger-inner"></span>
            </span>
        </button>
    </div>
</div>

<div class="app-header__menu">
    <span>
        <button type="button" class="btn-icon btn-icon-only btn btn-primary btn-sm mobile-toggle-header-nav">
            <span class="btn-icon-wrapper">
                <i class="fa fa-ellipsis-v fa-w-6"></i>
            </span>
        </button>
    </span>
</div>

<div class="app-header__content">
    <div class="app-header-left">
        {# ========================================= #}
        {# FISCAL YEAR & PERIOD DISPLAY #}
        {# Data comes from core.context_processors.active_fiscal_period #}
        {# ========================================= #}
        <div class="header-fiscal-info me-3" style="display: flex; align-items: center; gap: 12px;">
            {# Active Fiscal Year #}
            {% if active_fiscal_year %}
            <div class="fiscal-year-badge">
                <a href="{% url 'core:fiscal_year_detail' active_fiscal_year.id %}" 
                   class="btn btn-sm btn-primary" 
                   data-bs-toggle="tooltip" 
                   data-bs-placement="bottom"
                   title="View Fiscal Year Details - {{ fiscal_year_progress }}% complete"
                   style="display: flex; align-items: center; gap: 8px; padding: 6px 12px;">
                    <i class="pe-7s-date" style="font-size: 1.1rem;"></i>
                    <div style="text-align: left;">
                        <div style="font-size: 0.65rem; opacity: 0.8; text-transform: uppercase; letter-spacing: 0.5px;">
                            Fiscal Year
                        </div>
                        <div style="font-size: 0.85rem; font-weight: 600;">
                            {{ fiscal_year_name }}
                        </div>
                    </div>
                    {# Progress indicator #}
                    {% if fiscal_year_progress > 0 %}
                    <div style="width: 35px; height: 3px; background: rgba(255,255,255,0.3); border-radius: 2px; overflow: hidden;">
                        <div style="width: {{ fiscal_year_progress }}%; height: 100%; background: #fff; transition: width 0.3s;"></div>
                    </div>
                    {% endif %}
                </a>
            </div>
            {% else %}
            <div class="fiscal-year-badge">
                <a href="{% url 'core:fiscal_year_list' %}" 
                   class="btn btn-sm btn-warning" 
                   data-bs-toggle="tooltip"
                   title="No Active Fiscal Year - Click to Setup">
                    <i class="pe-7s-attention"></i>
                    <span>Setup Fiscal Year</span>
                </a>
            </div>
            {% endif %}

            {# Active Fiscal Period #}
            {% if active_period %}
            <div class="fiscal-period-badge">
                <a href="{% url 'core:period_detail' active_period.id %}" 
                   class="btn btn-sm btn-success" 
                   data-bs-toggle="tooltip"
                   data-bs-placement="bottom"
                   title="View Period Details - {{ period_remaining_days }} days remaining"
                   style="display: flex; align-items: center; gap: 8px; padding: 6px 12px;">
                    <i class="pe-7s-stopwatch" style="font-size: 1.1rem;"></i>
                    <div style="text-align: left;">
                        <div style="font-size: 0.65rem; opacity: 0.8; text-transform: uppercase; letter-spacing: 0.5px;">
                            Period
                        </div>
                        <div style="font-size: 0.85rem; font-weight: 600;">
                            {{ period_name }}
                        </div>
                    </div>
                    {# Days remaining badge #}
                    {% if period_remaining_days > 0 %}
                    <div style="font-size: 0.7rem; background: rgba(255,255,255,0.25); padding: 2px 6px; border-radius: 3px; font-weight: 600;">
                        {{ period_remaining_days }}d
                    </div>
                    {% endif %}
                    {# Warning if ending soon #}
                    {% if period_ending_soon %}
                    <i class="pe-7s-attention text-warning" style="font-size: 0.9rem;" title="Period ending soon!"></i>
                    {% endif %}
                </a>
            </div>
            {% else %}
            <div class="fiscal-period-badge">
                <a href="{% url 'core:period_list' %}" 
                   class="btn btn-sm btn-info" 
                   data-bs-toggle="tooltip"
                   title="No Active Period">
                    <i class="pe-7s-clock"></i>
                    <span>No Active Period</span>
                </a>
            </div>
            {% endif %}
        </div>

        {# Original search wrapper #}
        <div class="search-wrapper">
            <div class="input-holder">
                <input type="text" class="search-input" placeholder="Type to search">
                <button class="search-icon">
                    <span></span>
                </button>
            </div>
            <button class="btn-close"></button>
        </div>

        {# Keep your original mega menu if needed #}
        <ul class="header-megamenu nav">
            {# Your existing mega menu code can stay here if you want it #}
        </ul>
    </div>

    <div class="app-header-right">
        <div class="header-dots">
            {# System Alerts Dropdown - shows configuration warnings #}
            {% if system_alerts %}
            <div class="dropdown">
                <button type="button" aria-haspopup="true" aria-expanded="false"
                    data-bs-toggle="dropdown" class="p-0 me-2 btn btn-link">
                    <span class="icon-wrapper icon-wrapper-alt rounded-circle">
                        <span class="icon-wrapper-bg bg-warning"></span>
                        <i class="icon text-warning pe-7s-attention"></i>
                        <span class="badge badge-dot badge-dot-sm bg-danger">{{ system_alerts|length }}</span>
                    </span>
                </button>
                <div tabindex="-1" role="menu" aria-hidden="true"
                    class="dropdown-menu-lg rm-pointers dropdown-menu dropdown-menu-right">
                    <div class="dropdown-menu-header">
                        <div class="dropdown-menu-header-inner bg-warning">
                            <div class="menu-header-content text-dark">
                                <h5 class="menu-header-title">System Alerts</h5>
                                <h6 class="menu-header-subtitle">{{ system_alerts|length }} item{{ system_alerts|length|pluralize }} need{{ system_alerts|length|pluralize:"s," }} attention</h6>
                            </div>
                        </div>
                    </div>
                    <div class="scroll-area-sm">
                        <div class="scrollbar-container p-2">
                            {% for alert in system_alerts %}
                            <div class="alert alert-{{ alert.level }} mb-2" role="alert">
                                <strong>{{ alert.message }}</strong>
                                {% if alert.action_url %}
                                <div class="mt-2">
                                    <a href="{{ alert.action_url }}" class="btn btn-sm btn-{{ alert.level }}">
                                        {{ alert.action_text }}
                                    </a>
                                </div>
                                {% endif %}
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}

            {# Quick Stats Dropdown #}
            <div class="dropdown">
                <button type="button" aria-haspopup="true" aria-expanded="false"
                    data-bs-toggle="dropdown" class="p-0 me-2 btn btn-link">
                    <span class="icon-wrapper icon-wrapper-alt rounded-circle">
                        <span class="icon-wrapper-bg bg-primary"></span>
                        <i class="icon text-primary ion-android-apps"></i>
                    </span>
                </button>
                <div tabindex="-1" role="menu" aria-hidden="true"
                    class="dropdown-menu-xl rm-pointers dropdown-menu dropdown-menu-right">
                    <div class="dropdown-menu-header">
                        <div class="dropdown-menu-header-inner bg-plum-plate">
                            <div class="menu-header-image" style="background-image: url('{% static 'images/dropdown-header/abstract4.jpg' %}');"></div>
                            <div class="menu-header-content text-white">
                                <h5 class="menu-header-title">Quick Access</h5>
                                <h6 class="menu-header-subtitle">Core system navigation</h6>
                            </div>
                        </div>
                    </div>
                    <div class="grid-menu grid-menu-xl grid-menu-3col">
                        <div class="g-0 row">
                            <div class="col-sm-6 col-xl-4">
                                <a href="{% url 'core:fiscal_year_list' %}" class="btn-icon-vertical btn-square btn-transition btn btn-outline-link">
                                    <i class="pe-7s-date icon-gradient bg-night-fade btn-icon-wrapper btn-icon-lg mb-3"></i>
                                    Fiscal Years
                                    <div class="badge bg-primary">{{ fiscal_years_count }}</div>
                                </a>
                            </div>
                            <div class="col-sm-6 col-xl-4">
                                <a href="{% url 'core:period_list' %}" class="btn-icon-vertical btn-square btn-transition btn btn-outline-link">
                                    <i class="pe-7s-stopwatch icon-gradient bg-night-fade btn-icon-wrapper btn-icon-lg mb-3"></i>
                                    Periods
                                    <div class="badge bg-success">{{ periods_count }}</div>
                                </a>
                            </div>
                            <div class="col-sm-6 col-xl-4">
                                <a href="{% url 'core:payment_method_list' %}" class="btn-icon-vertical btn-square btn-transition btn btn-outline-link">
                                    <i class="pe-7s-cash icon-gradient bg-night-fade btn-icon-wrapper btn-icon-lg mb-3"></i>
                                    Payment Methods
                                    <div class="badge bg-info">{{ active_payment_methods_count }}</div>
                                </a>
                            </div>
                            <div class="col-sm-6 col-xl-4">
                                <a href="{% url 'core:sacco_configuration' %}" class="btn-icon-vertical btn-square btn-transition btn btn-outline-link">
                                    <i class="pe-7s-config icon-gradient bg-night-fade btn-icon-wrapper btn-icon-lg mb-3"></i>
                                    SACCO Config
                                </a>
                            </div>
                            <div class="col-sm-6 col-xl-4">
                                <a href="{% url 'core:financial_settings' %}" class="btn-icon-vertical btn-square btn-transition btn btn-outline-link">
                                    <i class="pe-7s-piggy icon-gradient bg-night-fade btn-icon-wrapper btn-icon-lg mb-3"></i>
                                    Financial Settings
                                </a>
                            </div>
                            <div class="col-sm-6 col-xl-4">
                                <a href="{% url 'core:tax_rate_list' %}" class="btn-icon-vertical btn-square btn-transition btn btn-outline-link">
                                    <i class="pe-7s-calculator icon-gradient bg-night-fade btn-icon-wrapper btn-icon-lg mb-3"></i>
                                    Tax Rates
                                    <div class="badge bg-warning">{{ active_tax_rates_count }}</div>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            {# Notifications - keep your original notifications dropdown #}
            <div class="dropdown">
                <button type="button" aria-haspopup="true" aria-expanded="false"
                    data-bs-toggle="dropdown" class="p-0 me-2 btn btn-link">
                    <span class="icon-wrapper icon-wrapper-alt rounded-circle">
                        <span class="icon-wrapper-bg bg-danger"></span>
                        <i class="icon text-danger icon-anim-pulse ion-android-notifications"></i>
                        <span class="badge badge-dot badge-dot-sm bg-danger">Notifications</span>
                    </span>
                </button>
                {# Your existing notifications dropdown content #}
            </div>

            {# Language selector - keep if you need it #}
            {# Chart stats - keep if you need it #}
        </div>

        {# User Profile Dropdown #}
        <div class="header-btn-lg pe-0">
            <div class="widget-content p-0">
                <div class="widget-content-wrapper">
                    <div class="widget-content-left">
                        <div class="btn-group">
                            <a data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="p-0 btn">
                                <img width="42" class="rounded-circle" src="{% static 'images/avatars/1.jpg' %}" alt="">
                                <i class="fa fa-angle-down ms-2 opacity-8"></i>
                            </a>
                            <div tabindex="-1" role="menu" aria-hidden="true"
                                class="rm-pointers dropdown-menu-lg dropdown-menu dropdown-menu-right">
                                <div class="dropdown-menu-header">
                                    <div class="dropdown-menu-header-inner bg-info">
                                        <div class="menu-header-image opacity-2" style="background-image: url('{% static 'images/dropdown-header/city3.jpg' %}');"></div>
                                        <div class="menu-header-content text-start">
                                            <div class="widget-content p-0">
                                                <div class="widget-content-wrapper">
                                                    <div class="widget-content-left me-3">
                                                        <img width="42" class="rounded-circle"
                                                            src="{% static 'images/avatars/1.jpg' %}" alt="">
                                                    </div>
                                                    <div class="widget-content-left">
                                                        <div class="widget-heading">{{ user.get_full_name|default:user.username }}</div>
                                                        <div class="widget-subheading opacity-8">{{ sacco_name|default:"SACCO Member" }}</div>
                                                    </div>
                                                    <div class="widget-content-right me-2">
                                                        <a href="{% url 'accounts:logout' %}" class="btn-pill btn-shadow btn-shine btn btn-focus">Logout</a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="scroll-area-xs" style="height: 150px;">
                                    <div class="scrollbar-container ps">
                                        <ul class="nav flex-column">
                                            <li class="nav-item-header nav-item">My Account</li>
                                            <li class="nav-item">
                                                <a href="javascript:void(0);" class="nav-link">
                                                    <i class="nav-link-icon pe-7s-user"></i>
                                                    Profile Settings
                                                </a>
                                            </li>
                                            <li class="nav-item">
                                                <a href="javascript:void(0);" class="nav-link">
                                                    <i class="nav-link-icon pe-7s-config"></i>
                                                    Account Settings
                                                </a>
                                            </li>
                                            {% if can_manage_finances %}
                                            <li class="nav-item-header nav-item">Administration</li>
                                            <li class="nav-item">
                                                <a href="{% url 'core:home' %}" class="nav-link">
                                                    <i class="nav-link-icon pe-7s-settings"></i>
                                                    Core Settings
                                                </a>
                                            </li>
                                            {% endif %}
                                        </ul>
                                    </div>
                                </div>
                                <ul class="nav flex-column">
                                    <li class="nav-item-divider nav-item"></li>
                                    <li class="nav-item-btn text-center nav-item">
                                        <a href="{% url 'accounts:logout' %}" class="btn-wide btn btn-danger btn-sm">
                                            <i class="pe-7s-power me-2"></i>Logout
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="widget-content-left  ms-3 header-user-info">
                        <div class="widget-heading">{{ user.get_full_name|default:user.username }}</div>
                        <div class="widget-subheading">
                            {% if user.is_superuser %}
                                Administrator
                            {% elif user.is_staff %}
                                Staff
                            {% else %}
                                Member
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{# Initialize tooltips #}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize Bootstrap tooltips
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });
});
</script>